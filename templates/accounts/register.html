{% extends 'accounts/base.html' %}

{% block body_block %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Registration</h2>

    {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
              {{ message }}
          </div>
      {% endfor %}
    {% endif %}
    
    <form method="post" class="needs-validation" novalidate>
        {% csrf_token %}
        
        <!-- Username Field -->
        <div class="row mb-3">
            <label for="{{ form.username.id_for_label }}" class="col-sm-2 col-form-label">Username:</label>
            <div class="col-sm-5">
                {{ form.username }}
                {% if form.username.errors %}
                    {% for error in form.username.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Email Field -->
        <div class="row mb-3">
            <label for="{{ form.email.id_for_label }}" class="col-sm-2 col-form-label">Email:</label>
            <div class="col-sm-5">
                {{ form.email }}
                {% if form.email.errors %}
                    {% for error in form.email.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- User Type Field -->
        <div class="row mb-3">
            <label for="{{ form.user_type.id_for_label }}" class="col-sm-2 col-form-label">User Type:</label>
            <div class="col-sm-5">
                {{ form.user_type }}
                {% if form.user_type.errors %}
                    {% for error in form.user_type.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Experience Level Field (For Team Manager or Player) -->
        <div id="experience_level_field" class="row mb-3 d-none">
            <label for="{{ form.experience_level.id_for_label }}" class="col-sm-2 col-form-label">Experience Level:</label>
            <div class="col-sm-5">
                {{ form.experience_level }}
                {% if form.experience_level.errors %}
                    {% for error in form.experience_level.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Role Field (For Player) -->
        <div id="role_field" class="row mb-3 d-none">
            <label for="{{ form.role.id_for_label }}" class="col-sm-2 col-form-label">Role:</label>
            <div class="col-sm-5">
                {{ form.role }}
                {% if form.role.errors %}
                    {% for error in form.role.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Password Field -->
        <div class="row mb-3">
            <label for="{{ form.password1.id_for_label }}" class="col-sm-2 col-form-label">Password:</label>
            <div class="col-sm-5">
                {{ form.password1 }}
                {% if form.password1.errors %}
                    {% for error in form.password1.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="row mb-3">
            <label for="{{ form.password2.id_for_label }}" class="col-sm-2 col-form-label">Confirm Password:</label>
            <div class="col-sm-5">
                {{ form.password2 }}
                {% if form.password2.errors %}
                    {% for error in form.password2.errors %}
                        <span style="color:red;font-size:small">{{ error }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Submit Button -->
        <div class="row justify-content-md-center">
            <button type="submit" class="btn btn-primary col-sm-3">Register</button>
        </div>
    </form>
</div>

<!-- JavaScript to toggle form fields based on user type without refreshing -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const userTypeDropdown = document.querySelector('#id_user_type');
    const experienceField = document.getElementById('experience_level_field');
    const roleField = document.getElementById('role_field');

    // Debugging: Log when the script runs
    console.log('Script loaded and running');

    // Function to toggle fields based on selected user type
    function toggleFields() {
        const userTypeValue = userTypeDropdown.value;

        // Debugging: Log the user type change
        console.log('User Type Changed:', userTypeValue);

        // Show experience level if user type is 'team_manager'
        if (userTypeValue === 'team_manager') {
            experienceField.classList.remove('d-none');
            roleField.classList.add('d-none');
        } 
        // Show role if user type is 'player'
        else if (userTypeValue === 'player') {
            roleField.classList.remove('d-none');
            experienceField.classList.add('d-none');
        } 
        // Hide both fields if user type is 'fan'
        else {
            experienceField.classList.add('d-none');
            roleField.classList.add('d-none');
        }
    }

    // Listen for changes in the User Type dropdown
    userTypeDropdown.addEventListener('change', toggleFields);

    // Set initial visibility of fields based on current value
    toggleFields();
});
</script>

{% endblock %}
